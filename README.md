# Amy_Workspace
**************************************
** 1. 개발 프레임워크 
**************************************
Spring Framework (Maven)

**************************************
** 2. 테이블 설계
**************************************
1) pay_trans_base
> 테이블한글명: 결제거래기본 테이블
> 설명: 결제거래 마스터테이블, 결제,결제취소 요청시 입력되며 거래의 가장 최신 데이터를 저장함.  
> 컬럼
  ( 컬럼명         | 컬럼영문명    | 도메인       | 설명                                    )
  ==========================================================================================
  - 관리번호       | unique_id (PK)| varchar(20)  | 거래고유번호
  - 거래구분       | trans_dv      | varchar(10)  | 기능 구분값, 승인(PAYMENT),취소(CANCEL) 
  - 카드번호       | card_no       | varchar(20)  | 카드번호
  - 할부개월수     | instm_month   | varchar(2)   | 일시불, 2~12개월, 취소시에는 일시불 00로 저장
  - 유효기간       | exp_dt        | varchar(4)   |
  - cvc            | cvc           | varchar(3)   |     
  - 거래금액       | trans_amt     | varchar(10)  | 
  - 부가가치세     | val_add_tax   | varchar(10)  |
  - 원거래관리번호 | org_unique_id | varchar(20)  |
  - string데이터   | string_data   | varchar(500) | 카드사로 전송하는 데이터 
  - 내용           | ctt           | varchar(50)  |
  - 등록일시       | reg_dtm       | datetime     |
  - 등록자         | reg_usr       | varchar(10)  | 
  ===========================================================================================
  

2) pay_trans_dtls
> 테이블한글명: 결제거래상세 테이블
> 설명: 결제거래 상세내역테이블, 최초 결제요청과 거래 발생 시 입력됨. 취소,부분취소,실패거래 등 모든 거래 내역을 저장함. (로그성테이블) 
       , 거래확인 및 부분취소 확인 시 사용 
> 컬럼
  ( 컬럼명                | 컬럼영문명      | 도메인       | 설명                                  )
  ==================================================================================================
  - 거래일련번호          | trans_seq (PK)  | int(20)      | 거래일련번호 
  - 관리번호              | unique_id (FK)  | varchar(20)  | 결제거래 기본 테이블의 PK를 참조한다. 삭제시 함께 삭제  
  - 거래성공여부          | success_yn      | varchar(1)   |
  - 거래구분              | trans_dv        | varchar(10)  | 기능 구분값, 승인(PAYMENT),취소(CANCEL) 
  - 원거래관리번호        | org_unique_id   | varchar(20)  |
  - 결재상태              | status          | varchar(1)   | 결제(0), 부분취소(1), 전체취소(2) 
  - 거래금액              | trans_amt       | varchar(10)  | 
  - 부가가치세            | val_add_tax     | varchar(10)  |
  - 결재상태인 금액       | pay_amt         | varchar(10)  | 결재상태로 남겨진 금액으로 원거래의 결재상태금액은 계속 update됨. 
  - 결재상태인 부가가치세 | pay_val_add_tax | varchar(10)  | 결재상태로 남겨진 금액으로 원거래의 부가가치세는 계속 update됨.
  - 내용                  | ctt             | varchar(50)  | 취소사유 등 입력 
  - 등록일시              | reg_dtm         | datetime     |
  - 등록자                | reg_usr         | varchar(10)  | 
  ==================================================================================================


**************************************
** 3. 문제해결 전략
**************************************
1) 문제 이해 및 프로세스 파악 
 - 프로그램의 목적과 제약조건 이해 
 - 이해한 내용을 바탕으로 프로세스를 파악(거래 흐름도 작성) 

2) 시스템 개발 일정 수립 및 to-do list 작성 
 - 1일차: 문제 이해, 일정수립, 프로세스 파악, 테이블 설계 
 - 2일차: 프로그램설계, 설계검증, 테이블 생성, 구현 
 - 3일차: 구현 및 테스트 
 - 4일차: 구현 및 테스트 
 - 5일차: 구현 및 테스트 
 - 6일차: 테스트, README 작성, 깃허브 최종 등록  

3) 프로그램 및 테이블 설계: 프로세스에 따른 프로그램 및 테이블 설계. 
 - 프로세스에 대한 알고리즘 설계 
 - 기본거래테이블과 거래의 상세내역을 저장하는 테이블 설계(부분취소를 감안함) 

4) 개발환경 설정: 자바, DB, 서버, 등 버전 결정 및 프레임워크 선택 
  - Server OS : Windows8
  - Language : JAVA 1.8
  - Framework : Spring 3
  - Server : Apache Tomcat 7
  - build tool : maven

5) 설계에 대한 간략한 검증 
 - 설계가 제약조건이나 변수를 만족시키는지에 대한 알고리즘 검토 

6) 구현: 설계에 따른 프로그램 구현
 - 각 API에 공통적으로 사용하는 기능(부가가치세 계산, 관리번호 채번, 데이터 체크) 
 - PaymentServiceImpl 에 비즈니스로직을 구현
 
 
7) 테스트 : 각 API를 단위테스트하며 미구현부분을 작성 후 해결 



**************************************
** 4. 빌드 및 실행 방법 
**************************************

---- 빌드
1) DB연동을 위한 mysql설치 필요
   - github repository에 TABLE_CREATE.sql 파일의 테이블 생성 
2) eclipse 설치 후 프로젝트를 지정된 workspace에 복사
3) eclipse 실행 후 import>Existing Project into Workspace 프로젝트'PaymentAPIProj'선택
4) tomcat 설치>이클립스 Server 탭에 tomcat 서버 추가
5) Server에 오른쪽 마우스클릭> Add and Remove> 'PaymentAPIProj' 프로젝트 선택 > Server Start!!!
6) [http://localhost:8080/payapi/main.do] 해당 url 실행
7) 메인화면이 뜨면 테스트하고자하는 API버튼을 클릭



----실행 
1) 결제 API 
  > 메인화면에서 '결제 요청' 버튼을 클릭 
  > 카드정보와 금액정보를 입력 
  > '요청'버튼 클릭
  > 응답 결과를 확인 ( consol에 요청 처리과정 확인: 암호화,금액 체크) 

 2) 결제취소 API (부분취소 포함) 
  > 메인화면에서 '결제취소 요청' 버튼을 클릭 
  > 원거래 관리번호 및 취소금액 입력, 부가가치세는 옵션값임
  > '취소요청'버튼 클릭
  > 응답 결과를 확인 ( consol에 요청 처리과정 확인: 암호화,금액 체크) 
  > 부분취소 시 원거래 결제관리번호를 입력해주세요. (취소거래 관리번호 X)
 
 3) 데이터 조회 API 
  > 메인화면에서 '데이터 조회' 버튼을 클릭 
  > 조회하고자하는 관리번호 입력
  > '조회'버튼 클릭
  > 응답 결과를 확인 ( consol에 요청 처리과정 확인: 복호화,String데이터 json포맷에 맞춰 조립과정) 

 4) API요청 실패시 
  > 각 API마다 오류코드 및 오류메세지 구현 


